<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta property="og:image" content="/CoRT/favicon_512.png">
		<title>Manuka's Timeline - Champions of Regnum</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="keywords" content="regnumsentinel champions regnum online trainer entrenador bosses war warzone guerra status">
		<meta name="description" content="A Timeline of everything that happened in Champions of Regnum (Regnum Online), originally created by Manuka.">
		<link rel="stylesheet" href="css/style.css">
		<link rel="icon" type="image/png" href="favicon.png">
		<link rel="apple-touch-icon" href="favicon.png" sizes="192x192">
		<script type="module" src="js/menu.js"></script>
		<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2117992780566693"
     crossorigin="anonymous"></script>
		<style>
			#loading {
				display: flex;
				justify-content: center;
				align-items: center;
				width: 100%;
				height: 100px;
			}

			#loading-text {
				font-size: 24px;
			}

			#iframe-container {
				display: none;
			}
		</style>
		<script>
			window.addEventListener('DOMContentLoaded', function() {
				var iframe = document.getElementById('iframe');
				var loading = document.getElementById('loading');
				var iframeContainer = document.getElementById('iframe-container');

				iframe.addEventListener('load', function() {
					loading.style.display = 'none';
					iframeContainer.style.display = 'block';
				});
			});

			// Listen for messages from the iframe
			window.addEventListener('message', function(event) {
				console.log('Requested edit of event:', event.data);
				// get the event data from /api/v1/events/:id and open the edit modal
				fetch('/api/v1/timeline/events/' + event.data)
					.then(response => response.json())
					.then(data => {
						console.log('Event data:', data);
						document.getElementById('edit-modal-title').value = data.title;
						document.getElementById('edit-modal-description').innerText = data.description;
						const startDate = new Date(data.start);
						const formattedStartDate = startDate.toISOString().split('T')[0];
						document.getElementById('edit-modal-start').value = formattedStartDate;
						const endDate = new Date(data.end);
						const formattedEndDate = endDate.toISOString().split('T')[0];
						document.getElementById('edit-modal-end').value = formattedEndDate;
						document.getElementById('edit-modal-id').innerText = data.id;
						document.getElementById('edit-modal').style.display = 'block';
					});
				
			});
		</script>
	</head>
	<body>
		<div id="menu" class="card"></div>
		<div id="main-container">
			<div class="bugnum but on your side">
				<noscript>
					For full functionality of this site it is necessary to enable JavaScript.
					Here are the <a href="https://www.enable-javascript.com/">
						instructions how to enable JavaScript in your web browser</a>.
				</noscript>
			</div>
			<h1 id="title">Manuka's Timeline</h1>
			<div id="loading">
				<p id="loading-text">Loading...</p>
			</div>
			<div class="card">
				<div id="iframe-container">
					<iframe id="iframe" style="width:100%;height:800px;border:none;padding-top:1em" scrolling="yes" src="data/timeline/index.html"></iframe>
				</div>
			</div>
			<!-- edit modal with form -->
			<div id="edit-modal" class="modal">
				<div class="card" style="max-width:70%;margin: 0 auto">
					<div class="modal-content">
						<span class="close">&times;</span>
						<form style="display: flex; flex-direction: column; gap: 1em;">
							<input type="hidden" id="edit-modal-id" name="id">
							<label for="edit-modal-title">Title:</label>
							<input type="text" id="edit-modal-title" name="title" required>
							<label for="edit-modal-description">Description:</label>
							<textarea id="edit-modal-description" name="description" required></textarea>
							<label for="edit-modal-start">Start:</label>
							<input type="date" id="edit-modal-start" name="start" required>
							<label for="edit-modal-end">End:</label>
							<input type="date" id="edit-modal-end" name="end" required>
							<button type="submit">Save</button>
						</form>
						<script>
							// submit the form to update the event
							document.querySelector('#edit-modal form').addEventListener('submit', function(event) {
								event.preventDefault();
								const id = document.getElementById('edit-modal-id').innerText;
								const title = document.getElementById('edit-modal-title').value;
								const description = document.getElementById('edit-modal-description').value;
								const start = document.getElementById('edit-modal-start').value;
								const end = document.getElementById('edit-modal-end').value;
								const data = {
									title,
									description,
									start,
									end
								};
								console.log('Updating event:', data);
								fetch('/api/v1/timeline/events/' + id, {
									method: 'PUT',
									headers: {
										'Content-Type': 'application/json'
									},
									body: JSON.stringify(data)
								})
									.then(response => response.json())
									.then(data => {
										console.log('Success:', data);
										document.getElementById('edit-modal').style.display = 'none';
										document.getElementById('iframe').contentWindow.location.reload();
									})
									.catch((error) => {
										console.error('Error:', error);
									});
							});
						</script>
					</div>
				</div>
			</div>
		<div id="footer" class="card">
			<div id="footer-menu"></div>
			<!-- Matomo -->
			<script>
				var _paq = window._paq = window._paq || [];
				/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
				_paq.push(['trackPageView']);
				_paq.push(['enableLinkTracking']);
				(function() {
				var u="//analytics.treudler.net/";
				_paq.push(['setTrackerUrl', u+'matomo.php']);
				_paq.push(['setSiteId', '20']);
				var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
				g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
				})();
			</script>
			<noscript><p><img referrerpolicy="no-referrer-when-downgrade" src="//analytics.treudler.net/matomo.php?idsite=20&amp;rec=1" style="border:0;" alt="" /></p></noscript>
			<!-- End Matomo Code -->
		</div>	</body>
</html>
